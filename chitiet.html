<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L√†m B√†i Chi Ti·∫øt</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>

    <div class="container">
        <a href="index.html" class="back-btn">‚Üê Tr·ªü v·ªÅ danh s√°ch</a>
        <div id="noidung-hienthi"><h2 style="text-align:center;">ƒêang t·∫£i n·ªôi dung...</h2></div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const baiId = urlParams.get('id');
        let currentProblem = null;

        if (!baiId) {
            document.getElementById('noidung-hienthi').innerHTML = '<h2>‚ùå Li√™n k·∫øt kh√¥ng h·ª£p l·ªá!</h2>';
        } else {
            fetch('data.json')
                .then(res => res.json())
                .then(data => {
                    currentProblem = data.find(item => item.id === baiId);
                    if (currentProblem) renderGiaoDien(currentProblem);
                    else document.getElementById('noidung-hienthi').innerHTML = '<h2>‚ùå Kh√¥ng t√¨m th·∫•y b√†i to√°n.</h2>';
                });
        }

        // H√ÄM RENDER HTML T√ôY THEO D·∫†NG B√ÄI
        function renderGiaoDien(baiToan) {
            let formKiemTra = '';

            // 1. D·∫°ng Tr·∫Øc nghi·ªám 4 ph∆∞∆°ng √°n
            if (baiToan.loai_cau === '4_phuong_an') {
                const lis = baiToan.lua_chon.map(opt => `<li><label><input type="radio" name="q" value="${opt.charAt(0)}"> ${opt}</label></li>`).join('');
                formKiemTra = `<div class="answer-section"><h3>Ch·ªçn ƒë√°p √°n ƒë√∫ng:</h3><ul class="options-4">${lis}</ul></div>`;
            } 
            // 2. D·∫°ng ƒê√∫ng/Sai
            else if (baiToan.loai_cau === 'dung_sai') {
                const rows = baiToan.cac_menh_de.map((md, idx) => `
                    <tr>
                        <td>${md.noi_dung}</td>
                        <td class="center"><input type="radio" name="ds-${idx}" value="true"></td>
                        <td class="center"><input type="radio" name="ds-${idx}" value="false"></td>
                    </tr>`).join('');
                formKiemTra = `<div class="answer-section"><h3>Ch·ªçn ƒê√∫ng/Sai cho t·ª´ng m·ªánh ƒë·ªÅ:</h3>
                               <table class="table-tf"><tr><th>M·ªánh ƒë·ªÅ</th><th class="center">ƒê√∫ng</th><th class="center">Sai</th></tr>${rows}</table></div>`;
            } 
            // 3. D·∫°ng Tr·∫£ l·ªùi ng·∫Øn
            else if (baiToan.loai_cau === 'tra_loi_ngan') {
                formKiemTra = `
                    <div class="answer-section">
                        <h3>Nh·∫≠p ƒë√°p √°n c·ªßa b·∫°n:</h3>
                        <div class="answer-flex">
                            <input type="text" id="user-answer" class="answer-input" placeholder="Nh·∫≠p k·∫øt qu·∫£...">
                        </div>
                    </div>`;
            }

            // X·ª≠ l√Ω Video YouTube
            let videoYouTube = (baiToan.youtube_id && baiToan.youtube_id !== "") 
                ? `<div class="video-container"><iframe src="https://www.youtube.com/embed/${baiToan.youtube_id}" allowfullscreen></iframe></div>` 
                : '';

            // B∆°m v√†o m√†n h√¨nh
            document.getElementById('noidung-hienthi').innerHTML = `
                <div class="content-box">
                    <div class="badges"><span class="badge badge-blue">${baiToan.ky_thi}</span></div>
                    <h2 class="question-title">N·ªôi dung c√¢u h·ªèi</h2>
                    <div class="question-content">${baiToan.cau_hoi}</div>
                </div>
                
                ${formKiemTra}
                
                <div style="display:flex; gap:10px; margin-bottom:24px;">
                    <button class="btn-check" onclick="checkAnswer()" style="flex:1;">Ki·ªÉm Tra ƒê√°p √Ån</button>
                    <button class="btn-solve" onclick="toggleSolution()" style="flex:1; margin:0; background:#64748b;">Xem L·ªùi Gi·∫£i</button>
                </div>
                
                <div id="feedback-msg" class="feedback-msg" style="margin-bottom: 20px; text-align:center;"></div>
                
                <div id="loi-giai" class="solution-box">
                    <h3>Th√¥ng tin chi ti·∫øt</h3>
                    <hr style="border: 0; border-top: 1px dashed #a7f3d0; margin: 16px 0;">
                    <div class="solution-content">${baiToan.loi_giai}</div>
                    ${videoYouTube}
                </div>
            `;

            if (window.MathJax) MathJax.typesetPromise();
        }

        // H√ÄM KI·ªÇM TRA ƒê√ÅP √ÅN
        window.checkAnswer = function() {
            const feedbackEl = document.getElementById('feedback-msg');
            let isCorrect = false;

            if (currentProblem.loai_cau === '4_phuong_an') {
                const selected = document.querySelector(`input[name="q"]:checked`);
                if (!selected) return feedbackEl.innerHTML = '<span style="color:#f59e0b;">‚ö†Ô∏è Vui l√≤ng ch·ªçn 1 ƒë√°p √°n!</span>';
                if (selected.value === currentProblem.dap_an) isCorrect = true;
            } 
            else if (currentProblem.loai_cau === 'dung_sai') {
                let correctCount = 0; let allAnswered = true;
                currentProblem.cac_menh_de.forEach((md, idx) => {
                    const selected = document.querySelector(`input[name="ds-${idx}"]:checked`);
                    if (!selected) allAnswered = false;
                    else if ((selected.value === 'true') === md.dap_an) correctCount++;
                });
                if (!allAnswered) return feedbackEl.innerHTML = '<span style="color:#f59e0b;">‚ö†Ô∏è Vui l√≤ng ch·ªçn ƒê/S cho t·∫•t c·∫£ m·ªánh ƒë·ªÅ!</span>';
                
                if (correctCount === currentProblem.cac_menh_de.length) isCorrect = true;
                else return feedbackEl.innerHTML = `<span style="color:var(--danger);">‚ùå B·∫°n l√†m ƒë√∫ng ${correctCount}/${currentProblem.cac_menh_de.length} √Ω.</span>`;
            } 
            else if (currentProblem.loai_cau === 'tra_loi_ngan') {
                const inputVal = document.getElementById(`user-answer`).value.trim();
                if (inputVal === '') return feedbackEl.innerHTML = '<span style="color:#f59e0b;">‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë√°p √°n!</span>';
                if (inputVal.toLowerCase().replace(/\s/g, '') === currentProblem.dap_an_ngan.toLowerCase().replace(/\s/g, '')) isCorrect = true;
            }

            if (isCorrect) feedbackEl.innerHTML = '<span style="color:var(--success);">üéâ Ch√≠nh x√°c! B·∫°n l√†m r·∫•t t·ªët!</span>';
            else feedbackEl.innerHTML = '<span style="color:var(--danger);">‚ùå Sai r·ªìi, b·∫°n h√£y t√≠nh to√°n l·∫°i nh√©!</span>';
        };

        window.toggleSolution = function() {
            const solBox = document.getElementById('loi-giai');
            solBox.style.display = (solBox.style.display === 'none' || solBox.style.display === '') ? 'block' : 'none';
        };
    </script>
</body>
</html>
